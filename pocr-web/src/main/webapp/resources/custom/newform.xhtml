<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"      
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:p="http://primefaces.org/ui"
      xmlns:composite="http://java.sun.com/jsf/composite">  
      
    <h:body>
 		<composite:interface>
 			<composite:attribute name="formBean" />
 		
 		</composite:interface>
 		
 		<composite:implementation>
 			<h:form id="newForm-form">
 				<p:panel id="createFormPnl" style="padding: 50px 25px 25px;" >
 				
		    		<p:growl id="growl" life="5000" />
		    	
		    		<h:panelGroup id="form" styleClass="lineOfElements">
		    			<dl class="element">
				    		<dt><p:outputLabel for="formName" id="formNameLbl" value="#{msg['newform.formName']}"/></dt>      
					    	<dd><p:inputText id="formName" value="#{cc.attrs.formBean.formName}" required="true" 
					    					 requiredMessage="#{msg['newform.required.formName']}"
					    					 validatorMessage="#{msg['newform.valid.formName']}">
					    			<f:ajax />
					    			<f:validateRegex pattern="^[a-zA-Z][a-zA-Z0-9]*?$"/>
					    		</p:inputText>
					    		<p:watermark for="formName" value="#{msg['common.validClassName']}" id="formNameWm" />
					    	</dd>
					    </dl>
					    
					    <div class="element">
					    	<p:commandButton id="addField" value="#{msg['newform.addField']}" update="formFields"  immediate="true"
				    				 actionListener="#{cc.attrs.formBean.addField}"  icon="ui-icon-plus" ajax="true" />
			  			</div>  	
				    </h:panelGroup>
				    		    
			    	<h:panelGroup id="formFields" binding="#{formFieldsComponent}" styleClass="linesGroup">
				    	<ui:repeat var="field" value="#{cc.attrs.formBean.fields}">
				    	    <h:panelGroup layout="block" styleClass="lineOfElements" id="row">
				    	    	<dl class="element">
									<dt><p:outputLabel id="fieldNameLbl" for="fieldName" value="#{msg['newform.fieldName']}"/></dt>
									<dd><p:inputText id="fieldName" value="#{field.fieldName}" required="true" 
													 requiredMessage="#{msg['newform.required.fieldName']}" 
													 validatorMessage="#{msg['newform.valid.fieldName']}">
											<f:ajax />
											<f:validateRegex pattern="^[a-zA-Z][a-zA-Z0-9]*?$" />
										</p:inputText>
										<p:watermark for="fieldName" value="#{msg['common.validIdentifierName']}" id="fieldNameWm" />
									</dd>
								</dl>
								<dl class="element">
									<dt><p:outputLabel id="fieldTypeLbl" for="fieldType" value="#{msg['newform.fieldType']}"/></dt>
									<dd><p:selectOneMenu id="fieldType"  value="#{field.fieldType}" >
											<f:ajax />
								            <f:selectItems value="#{fieldTypesBean.types}" />
								        </p:selectOneMenu></dd>
								</dl>
								<dl class="element">
									<dt><p:outputLabel id="fieldRequiredLbl" for="fieldRequired" value="#{msg['newform.required']}"/></dt>
									<dd><p:selectBooleanButton id="fieldRequired" value="#{field.required}" onLabel="#{msg['common.yes']}" offLabel="#{msg['common.no']}" 
																onIcon="ui-icon-check" offIcon="ui-icon-close" style="width:60px" >
											<f:ajax />
										</p:selectBooleanButton>							
									</dd>
								</dl>
								<dl class="element">
									<dt><h:outputLabel id="fieldDescriptionLbl" for="fieldDescription" value="#{msg['newform.description']}"/></dt>
									<dd><p:inputText id="fieldDescription" value="#{field.description}" style="width:200px">
										<f:ajax />
									</p:inputText>
									</dd>
								</dl>
								
								<p:commandButton action="#{cc.attrs.formBean.removeField(field)}" id="removeField" styleClass="element"
												update=":#{formFieldsComponent.clientId}" icon="ui-icon-close" immediate="true"/>
								
							</h:panelGroup>
				        </ui:repeat>
			        </h:panelGroup>
			        
			        <h:panelGroup styleClass="lineOfElements" id="buttons">
			        	<p:commandButton id="submit" value="#{msg['common.submit']}" type="submit" update="createFormPnl"/>
			        	<p:commandButton id="reset" value="#{msg['common.reset']}" immediate="true" update="createFormPnl" action="#{cc.attrs.formBean.reset}"/>
			        	<p:commandButton id="cancel" value="#{msg['common.cancel']}" type="cancel" immediate="true" />
			        </h:panelGroup>
			        
			        <!-- TODO: find a better CSS solution -->
			        <div style="clear:both"></div>
			        
			    
		        
		     	</p:panel>
		     </h:form>   
		</composite:implementation>
    </h:body>  
</html>  
